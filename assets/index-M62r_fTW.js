(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const c={x:150,y:0,size:60,velocity_y:0,gravity:.5,jump_strength:-10,jump:function(){this.velocity_y=this.jump_strength},draw:function(e,t){if(!t)return;e.save(),e.translate(this.x,this.y);const i=Math.atan2(this.velocity_y,20)*.3;e.rotate(i),e.drawImage(t,-this.size/2,-this.size/2,this.size,this.size),e.restore()},update:function(){this.velocity_y+=this.gravity,this.y+=this.velocity_y}};function H(e,t,i,n,s,o){const r=t.split(" ");let w="",S=n;const m=[];r.forEach(f=>{const u=w+f+" ";e.measureText(u).width>s&&w.length>0?(m.push(w),w=f+" "):w=u}),m.push(w),S-=(m.length-1)*o/2,m.forEach((f,u)=>{e.fillText(f.trim(),i,S+u*o)})}const h=[],L=[];function G(e,t){h.length=0,L.length=0;const i=100,n=4,s=Math.max(150,c.size*1.5),o="#FF4500",r=n*s,w=e.height-r;if(w<0){console.error("Not enough space for tunnels. Reduce tunnel height or number of tunnels.");return}const S=w/(n+1);let m=0;for(let f=0;f<n+1;f++)if(h.push({x:e.width,y:m,width:i,height:S,isWall:!0,draw:function(u,p){u.fillStyle=o,u.fillRect(this.x,this.y,this.width,this.height)},update:function(u){this.x-=u}}),f<n){const u=m+S;L.push({x:e.width,y:u,width:i,height:s,isCorrect:f===t.correctAnswer,answerText:t.answers[f],draw:function(p){p.fillStyle="white",p.font="14px 'Press Start 2P'",p.textAlign="center";const B=this.width-10,R=18,Y=this.x+this.width/2,k=this.y+this.height/2;H(p,this.answerText,Y,k,B,R),p.textAlign="left"},update:function(p){this.x-=p}}),m+=S+s}}function J(e,t){if(e.y-e.size/2<=0)return"ceiling";if(e.y+e.size/2>=t.height)return"floor";if(h.length===0)return null;const i=h[0].x,n=h[0].width,s=e.x+e.size/2,o=e.x-e.size/2;if(s<i||o>i+n)return null;for(const r of h)if(s>r.x&&o<r.x+r.width&&e.y+e.size/2>r.y&&e.y-e.size/2<r.y+r.height)return"wall";for(const r of L)if(e.y>=r.y&&e.y<=r.y+r.height)return r.isCorrect?"correct":"incorrect";return"wall"}const g={text:"",correctAnswer:null,answers:[],display:!1};function N(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function U(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}function q(e){const t=e.incorrect_answers.map(o=>N(o)),i=N(e.correct_answer),n=U([...t,i]),s=n.indexOf(i);return{question:N(e.question),answers:n,correct_answer:s}}async function F(e){try{const t=await fetch(`https://opentdb.com/api.php?amount=1&category=${e}&type=multiple`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();if(i.response_code!==0)throw new Error(`API returned response code: ${i.response_code}`);const n=q(i.results[0]);g.text=n.question,g.correctAnswer=n.correct_answer,g.answers=n.answers,g.display=!0}catch(t){console.error("Error fetching question:",t),g.text="Error loading question. Please try again.",g.display=!0,g.answers=[]}}const y=[],E=new Image;E.src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJtMTIgMjEuNzVsLTguNzUtMy43N3YtOC4xM2MwLTMuNTUgMi4yOS02LjggNS42Mi04LjM4bDIuMjUtMS4wMWwxLjYyLTAuNzNsMS4yNi0wLjU2bDEuMjUgMC41NmwxLjYyIDAuNzNsMi4yNSAxLjAxbDUuNjIgOC4zOHY4LjEzbC04Ljc1IDMuNzdtMCAwIiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMS41Ii8+PHBhdGggZD0ibTEyIDIxLjc1bC04Ljc1LTMuNzd2LTguMTNjMC0zLjTUDIuMjktNi44IDUuNjItOC4zOGwyLjI1LTEuMDFsMS42Mi0wLjczbDQuMTMgMS44NWw1LjYyIDguMzh2OC4xM2wtOC43NSAzLjc3bTAgMCIgZmlsbD0iIzQxN2VmNCIvPjwvc3ZnPg==";const W=new Image;W.src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMC41IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMS41Ii8+PHBhdGggZD0iTTEyIDYuNXY1LjVoMy45IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L3N2Zz4=";function X(e){const t=["shield","slowmo"],i=t[Math.floor(Math.random()*t.length)],n={x:e.width,y:Math.random()*(e.height-100)+50,size:40,type:i};y.push(n)}function $(e){for(let t=y.length-1;t>=0;t--){const i=y[t];i.x-=e,i.x+i.size<0&&y.splice(t,1)}}function Q(e){y.forEach(t=>{t.type==="shield"?e.drawImage(E,t.x,t.y,t.size,t.size):t.type==="slowmo"&&e.drawImage(W,t.x,t.y,t.size,t.size)})}function O(e){e.width=window.innerWidth,e.height=window.innerHeight}function V(e,t,i){e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(0,0,t.width,t.height),e.font='40px "Press Start 2P"',e.fillStyle="white",e.textAlign="center",e.fillText("Game Over",t.width/2,t.height/2-80),e.font='20px "Press Start 2P"',e.fillText(`Pontszám: ${i.value}`,t.width/2,t.height/2-20),e.fillStyle="#FF6A00",e.fillRect(t.width/2-100,t.height/2+20,200,50),e.font='20px "Press Start 2P"',e.fillStyle="white",e.fillText("Play Again",t.width/2,t.height/2+55)}function K(e,t){e.font="20px Arial",e.fillStyle="black",e.fillText("Pontszám: "+t.value,10,60)}function ee(e,t,i){e.font="20px 'Press Start 2P'",e.fillStyle="white",e.textAlign="center";const n=i.width*.8,s=25,o=i.width/2;H(e,t.text,o,50,n,s),e.textAlign="left"}function te(e,t,i,n="white"){e.font='30px "Press Start 2P"',e.fillStyle=n,e.textAlign="center",e.fillStyle="rgba(0, 0, 0, 0.5)";const s=e.measureText(i).width;e.fillRect(t.width/2-s/2-20,t.height/2-40,s+40,70),e.fillStyle=n,e.fillText(i,t.width/2,t.height/2+10),e.textAlign="left"}function ie(e){e.drawImage(E,10,90,40,40)}const d={jump:new Audio("https://freesound.org/data/previews/135/135936_2434988-lq.mp3"),score:new Audio("https://freesound.org/data/previews/270/270319_5123851-lq.mp3"),gameOver:new Audio("https://freesound.org/data/previews/219/219244_4082829-lq.mp3"),background:new Audio("https://freesound.org/data/previews/396/396740_5218259-lq.mp3")};d.background.loop=!0;d.background.volume=.3;function ne(){d.jump.currentTime=0,d.jump.play()}function se(){d.score.currentTime=0,d.score.play()}function oe(){d.gameOver.currentTime=0,d.gameOver.play()}function Z(){d.background.play()}function re(){d.background.pause(),d.background.currentTime=0}const I=[];class le{constructor(t,i){this.x=t,this.y=i,this.size=Math.random()*5+2,this.speedX=Math.random()*6-3,this.speedY=Math.random()*6-3,this.color=`hsl(${Math.random()*60+0}, 100%, 50%)`,this.ttl=Math.random()*100+50}update(){this.x+=this.speedX,this.y+=this.speedY,this.ttl--}draw(t){t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill()}}function ae(e,t){for(let n=0;n<50;n++)I.push(new le(e,t))}function ce(){for(let e=I.length-1;e>=0;e--)I[e].update(),I[e].ttl<=0&&I.splice(e,1)}function ue(e){I.forEach(t=>t.draw(e))}function v(e){return new Promise((t,i)=>{const n=new Image;n.onload=()=>t(n),n.onerror=i,n.src=e})}async function he(){const[e,t,i]=await Promise.all([v("./background.png"),v("./character.gif"),v("./obstacle.png")]);return{background:e,character:t,obstacle:i}}const l=document.getElementById("gameCanvas"),a=l.getContext("2d");let b,z="playing",T={value:0},j=4;const de=9;let x=!1,M={text:"",ttl:0,color:"white"},A=!1,C=!0;function D(e,t,i="white"){M.text=e,M.ttl=t,M.color=i}function fe(){for(let e=y.length-1;e>=0;e--){const t=y[e];Math.hypot(c.x-t.x,c.y-t.y)-c.size/2-t.size/2<1&&(t.type==="shield"&&(x=!0),y.splice(e,1))}}async function P(){c.y=l.height/2,c.velocity_y=0,c.gravity=0,await F(de),G(l,g),A=!1,C=!0}function ge(){T.value=0,j=4,x=!1,y.length=0,I.length=0,z="playing",Z(),P()}function we(){re(),oe(),ae(c.x,c.y),z="gameOver"}function _(){if(a.clearRect(0,0,l.width,l.height),a.drawImage(b.background,0,0,l.width,l.height),z==="playing"){if(c.update(),c.draw(a,b.character),h.forEach(e=>{e.update(j),e.draw(a,b.obstacle)}),L.forEach(e=>{e.update(j),e.draw(a)}),$(j),Q(a),fe(),!A){const e=J(c,l);e&&(A=!0,e==="correct"?(se(),T.value++,D("Helyes!",60,"green"),Math.random()<.25&&X(l),setTimeout(P,500)):e==="incorrect"?(D("Rossz!",60,"red"),setTimeout(P,500)):["wall","ceiling","floor"].includes(e)&&(x?(x=!1,h.forEach(t=>t.x+=150),L.forEach(t=>t.x+=150),A=!1):we()))}h.length>0&&h[0].x<-h[0].width&&(D("Rossz!",60,"red"),P()),g.display&&ee(a,g,l),K(a,T),x&&ie(a),M.ttl>0&&(te(a,l,M.text,M.color),M.ttl--)}else z==="gameOver"&&V(a,l,T);ce(),ue(a),requestAnimationFrame(_)}document.addEventListener("keydown",e=>{e.code==="Space"&&z==="playing"&&(C&&(c.gravity=.5,C=!1),c.jump(),ne())});l.addEventListener("click",function(e){if(z==="gameOver"){const t=l.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,s=l.width/2-100,o=l.height/2+20;i>=s&&i<=s+200&&n>=o&&n<=o+50&&ge()}});async function ye(){O(l),window.addEventListener("resize",()=>O(l)),a.fillStyle="black",a.font="20px 'Press Start 2P'",a.textAlign="center",a.fillText("Loading assets...",l.width/2,l.height/2),b=await he(),Z(),await P(),_()}ye();
